<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>R√¢u Coin</title>
    <!-- T√≠ch h·ª£p Tailwind CSS ƒë·ªÉ l√†m giao di·ªán nhanh v√† ƒë·∫πp -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- T√≠ch h·ª£p th∆∞ vi·ªán Telegram Mini App -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            -webkit-user-select: none; /* Safari */
            -ms-user-select: none; /* IE 10+ */
            user-select: none; /* Standard syntax */
            touch-action: manipulation;
        }
        .tap-button {
            transition: transform 0.05s ease-in-out;
        }
        .tap-button:active {
            transform: scale(0.95);
        }
        .floating-text {
            position: absolute;
            font-size: 2.5rem;
            font-weight: bold;
            color: white;
            opacity: 0;
            animation: float-up 1s ease-out forwards;
            pointer-events: none;
        }
        @keyframes float-up {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-100px); opacity: 0; }
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-between h-screen p-4 overflow-hidden">

    <!-- Ph·∫ßn ch√≠nh c·ªßa ·ª©ng d·ª•ng -->
    <main class="w-full max-w-sm flex flex-col items-center justify-center flex-grow text-center">
        <!-- Th√¥ng tin ng∆∞·ªùi d√πng -->
        <div class="mb-4">
            <p id="user-info" class="text-lg font-medium text-gray-300">ƒêang t·∫£i...</p>
        </div>

        <!-- S·ªë d∆∞ R√¢u Coin -->
        <div class="flex items-center justify-center mb-4 space-x-3">
            <svg class="w-10 h-10 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 10v-1m0-6c-1.11 0-2.08-.402-2.599-1M12 16c-2.76 0-5-1.79-5-4s2.24-4 5-4 5 1.79 5 4-2.24 4-5 4z"></path></svg>
            <h1 id="balance" class="text-5xl font-black">0</h1>
        </div>
        
        <!-- N√∫t ƒë√†o coin ch√≠nh -->
        <div id="tap-container" class="relative w-64 h-64 md:w-72 md:h-72 my-8">
            <button id="tap-button" class="tap-button w-full h-full bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center shadow-lg active:shadow-2xl">
                <!-- Icon R√¢u -->
                <svg xmlns="http://www.w3.org/2000/svg" class="w-32 h-32 text-gray-900" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M6 20c0-3.309 2.691-6 6-6s6 2.691 6 6h-12zm-4-6c0-4.411 3.589-8 8-8s8 3.589 8 8c-2.053 0-3.887-1.03-5.064-2.598-1.551 1.054-3.36 1.598-5.269 1.598-.222 0-.441-.008-.667-.024z"/>
                </svg>
            </button>
        </div>

        <!-- Thanh nƒÉng l∆∞·ª£ng -->
        <div class="w-full px-4">
            <div class="flex justify-between items-center text-lg mb-1">
                <span class="font-bold">‚ö° NƒÉng l∆∞·ª£ng</span>
                <span id="energy-level" class="font-bold">1000 / 1000</span>
            </div>
            <div class="w-full bg-gray-700 rounded-full h-4">
                <div id="energy-bar" class="bg-gradient-to-r from-green-400 to-blue-500 h-4 rounded-full" style="width: 100%"></div>
            </div>
        </div>
    </main>

    <!-- Thanh ch·ª©c nƒÉng d∆∞·ªõi c√πng -->
    <footer class="w-full max-w-sm grid grid-cols-2 gap-4">
        <button id="invite-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105">
            ü§ù M·ªùi b·∫°n b√®
        </button>
        <button id="wallet-btn" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105">
            üíº V√≠ R√¢u Coin
        </button>
    </footer>

    <!-- Modal m·ªùi b·∫°n b√® -->
    <div id="invite-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4">
        <div class="bg-gray-800 rounded-2xl p-6 w-full max-w-md text-center shadow-xl">
            <h2 class="text-2xl font-bold mb-4">M·ªùi b·∫°n b√® v√† nh·∫≠n th∆∞·ªüng!</h2>
            <p class="text-gray-300 mb-6">Chia s·∫ª link b√™n d∆∞·ªõi. B·∫°n s·∫Ω nh·∫≠n ƒë∆∞·ª£c R√¢u Coin cho m·ªói ng∆∞·ªùi b·∫°n tham gia.</p>
            <div class="bg-gray-900 p-3 rounded-lg mb-4">
                <p id="referral-link" class="text-yellow-400 break-all">https://t.me/YourRauCoinBot?start=...
                </p>
            </div>
            <button id="copy-link-btn" class="bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-bold w-full py-3 rounded-lg mb-4">Sao ch√©p link</button>
            <button id="close-modal-btn" class="text-gray-400 hover:text-white w-full py-2">ƒê√≥ng</button>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const tg = window.Telegram.WebApp;
            tg.ready();
            tg.expand(); // M·ªü r·ªông Mini App ra to√†n m√†n h√¨nh

            // --- C√°c bi·∫øn tr·∫°ng th√°i c·ªßa game ---
            let balance = 0;
            let maxEnergy = 1000;
            let currentEnergy = 1000;
            let tapsPerClick = 1;
            let energyRegenRate = 1; // NƒÉng l∆∞·ª£ng h·ªìi m·ªói gi√¢y

            // --- L·∫•y c√°c ph·∫ßn t·ª≠ tr√™n trang ---
            const balanceEl = document.getElementById('balance');
            const tapButton = document.getElementById('tap-button');
            const tapContainer = document.getElementById('tap-container');
            const energyLevelEl = document.getElementById('energy-level');
            const energyBar = document.getElementById('energy-bar');
            const userInfoEl = document.getElementById('user-info');
            
            const inviteBtn = document.getElementById('invite-btn');
            const inviteModal = document.getElementById('invite-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const copyLinkBtn = document.getElementById('copy-link-btn');
            const referralLinkEl = document.getElementById('referral-link');


            // --- Kh·ªüi t·∫°o th√¥ng tin ng∆∞·ªùi d√πng ---
            if (tg.initDataUnsafe.user) {
                const user = tg.initDataUnsafe.user;
                const userId = user.id;
                userInfoEl.innerText = `Xin ch√†o, ${user.first_name}!`;
                
                // T·∫°o link gi·ªõi thi·ªáu
                const botUsername = 'YourRauCoinBot'; // THAY T√äN BOT C·ª¶A B·∫†N V√ÄO ƒê√ÇY
                referralLinkEl.innerText = `https://t.me/${botUsername}?start=${userId}`;
                
                // TODO: G·ªçi API backend ƒë·ªÉ l·∫•y d·ªØ li·ªáu th·ª±c t·∫ø c·ªßa ng∆∞·ªùi d√πng (balance, energy,...)
                // loadUserData(userId); 
            } else {
                userInfoEl.innerText = "Ch∆°i v·ªõi t∆∞ c√°ch kh√°ch";
                referralLinkEl.innerText = "Kh√¥ng th·ªÉ t·∫°o link gi·ªõi thi·ªáu.";
            }

            // --- H√†m c·∫≠p nh·∫≠t giao di·ªán ---
            function updateUI() {
                balanceEl.innerText = Math.floor(balance);
                energyLevelEl.innerText = `${Math.floor(currentEnergy)} / ${maxEnergy}`;
                energyBar.style.width = `${(currentEnergy / maxEnergy) * 100}%`;
            }

            // --- X·ª≠ l√Ω s·ª± ki·ªán ch·∫°m ---
            function handleTap(event) {
                if (currentEnergy >= tapsPerClick) {
                    currentEnergy -= tapsPerClick;
                    balance += tapsPerClick;

                    // Rung nh·∫π
                    if (tg.HapticFeedback) {
                        tg.HapticFeedback.impactOccurred('light');
                    }
                    
                    // T·∫°o hi·ªáu ·ª©ng s·ªë bay l√™n
                    const x = event.clientX || event.touches[0].clientX;
                    const y = event.clientY || event.touches[0].clientY;
                    createFloatingText(tapsPerClick, x, y);

                    updateUI();
                }
            }

            tapButton.addEventListener('click', handleTap);
            // H·ªó tr·ª£ c·∫£ touch event cho mobile
            tapButton.addEventListener('touchstart', (e) => {
                e.preventDefault(); // NgƒÉn h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa tr√¨nh duy·ªát
                handleTap(e);
            });


            function createFloatingText(amount, x, y) {
                const text = document.createElement('div');
                text.className = 'floating-text';
                text.innerText = `+${amount}`;
                text.style.left = `${x - 20}px`;
                text.style.top = `${y - 40}px`;
                tapContainer.appendChild(text);
                setTimeout(() => {
                    text.remove();
                }, 1000);
            }

            // --- H·ªìi nƒÉng l∆∞·ª£ng ---
            setInterval(() => {
                if (currentEnergy < maxEnergy) {
                    currentEnergy = Math.min(maxEnergy, currentEnergy + energyRegenRate);
                    updateUI();
                }
            }, 1000);
            
            // --- X·ª≠ l√Ω Modal m·ªùi b·∫°n b√® ---
            inviteBtn.addEventListener('click', () => {
                inviteModal.classList.remove('hidden');
            });
            
            closeModalBtn.addEventListener('click', () => {
                inviteModal.classList.add('hidden');
            });

            copyLinkBtn.addEventListener('click', () => {
                navigator.clipboard.writeText(referralLinkEl.innerText).then(() => {
                    copyLinkBtn.innerText = 'ƒê√£ sao ch√©p!';
                    tg.HapticFeedback.notificationOccurred('success');
                    setTimeout(() => {
                        copyLinkBtn.innerText = 'Sao ch√©p link';
                    }, 2000);
                });
            });

            // --- Kh·ªüi t·∫°o ---
            updateUI();
            
            // TODO: ƒê·ªãnh k·ª≥ g·ªçi API ƒë·ªÉ l∆∞u ti·∫øn tr√¨nh c·ªßa ng∆∞·ªùi d√πng l√™n server
            // setInterval(saveProgress, 10000); // V√≠ d·ª•: l∆∞u m·ªói 10 gi√¢y
        });
    </script>
</body>
</html>
